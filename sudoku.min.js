function Sudoku(a){this.valueCallback=(typeof(arguments[1])=="function")?arguments[1]:function(){};this.completeCallback=(typeof(arguments[2])=="function")?arguments[2]:function(){};this.input=a;this.initialised=false}Sudoku.prototype={initialise:function(){var c,b,a,d;this.output=[];this.tf=[];for(c=0;c<9;++c){this.tf[c]=[];this.output[c]=[];for(b=0;b<9;++b){this.tf[c][b]=[];this.output[c][b]=null;for(a=0;a<9;++a){this.tf[c][b][a]=true}}}for(c=0;c<9;++c){for(b=0;b<9;++b){d=parseInt(this.input[c][b],10);if(!isNaN(d)){this.setValue(c,b,d-1,false)}}}this.initialised=true;if(this.impossible()){this.completeCallback(false);return false}},solve:function(){if(!this.initialised){this.initialise()}this.basicCandidateElimination();if(this.solved()){this.completeCallback(true);return true}if(this.impossible()){this.completeCallback(false);return false}this.backtrack();if(this.solved()){this.completeCallback(true);return true}this.completeCallback(false);return false},basicCandidateElimination:function(){var f,e,d,p,o,l,m,b,a,h,g,n,c;for(f=0;f<9;++f){for(e=0;e<9;++e){l=0;m=[];b=0;a=[];h=0;g=[];for(d=0;d<9;d++){if(this.output[f][e]===null&&this.tf[f][e][d]===true){++l;m=[f,e,d]}if(this.output[f][d]===null&&this.tf[f][d][e]===true){++b;a=[f,d,e]}if(this.output[d][f]===null&&this.tf[d][f][e]===true){++h;g=[d,f,e]}}if(l==1){this.setValue(m[0],m[1],m[2])}if(b==1){this.setValue(a[0],a[1],a[2])}if(h==1){this.setValue(g[0],g[1],g[2])}if(l==1||b==1||h==1){this.basicCandidateElimination();return}}}for(p=0;p<3;++p){for(o=0;o<3;++o){for(d=0;d<9;++d){n=0;c=[];for(f=3*p;f<3*(p+1);++f){for(e=3*o;e<3*(o+1);++e){if(this.output[f][e]===null&&this.tf[f][e][d]===true){++n;c=[f,e,d]}}}if(n==1){this.setValue(c[0],c[1],c[2]);this.basicCandidateElimination();return}}}}},backtrack:function(){var f=10,l=[],a=[],h,d,c,b,g,e;for(d=0;d<9;++d){for(c=0;c<9;++c){h=0;for(b=0;b<9;++b){if(this.tf[d][c][b]===true){++h}}if(h<f&&h>1){f=h;l[0]=d;l[1]=c}if(f==2){break}}if(f==2){break}}for(b=0;b<9;++b){if(this.tf[l[0]][l[1]][b]===true){a.push(b)}}for(g=0,xLim=a.length;g<xLim;++g){e=new Sudoku(this.output);e.initialise();e.setValue(l[0],l[1],a[g],false);if(e.solve()){for(d=0;d<9;++d){for(c=0;c<9;++c){if(this.output[d][c]===null){this.setValue(d,c,e.output[d][c]-1)}}}return}}},setValue:function(c,b,f,e){var a,h,g,d;if(typeof(e)=="undefined"){e=true}this.output[c][b]=f+1;for(a=0;a<9;++a){this.tf[a][b][f]=false;this.tf[c][a][f]=false;this.tf[c][b][a]=false}g=c-(c%3)+3;d=b-(b%3)+3;for(a=c-(c%3);a<g;++a){for(h=b-(b%3);h<d;++h){this.tf[a][h][f]=false}}this.tf[c][b][f]=true;if(e===true){this.valueCallback(c,b,f+1)}},solved:function(){var b,a;for(b=0;b<9;++b){for(a=0;a<9;++a){if(this.output[b][a]===null){return false}}}return true},impossible:function(){var c,b,a,d;for(c=0;c<9;++c){for(b=0;b<9;++b){d=false;for(a=0;a<9;++a){if(this.tf[c][b][a]===true){d=true;break}}if(!d){return true}}}return false}};